import{g as n,s as l,l as u}from"./utils-DycB6jvq.js";const h="https://wdd330-backend.onrender.com/".replace(/\/$/,"")+"/";function d(s){return s.map(t=>({id:t.Id,price:t.FinalPrice,name:t.Name,quantity:t.Quantity||1}))}class m{constructor(t,e){this.key=t,this.outputSelector=e,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=n(this.key)||[],this.calculateItemSummary(),this.calculateOrdertotal()}calculateItemSummary(){this.itemTotal=this.list.reduce((e,o)=>e+o.FinalPrice*(o.Quantity||1),0);const t=document.querySelector(this.outputSelector+" #item-subtotal");t&&(t.innerText="$"+this.itemTotal.toFixed(2))}calculateOrdertotal(){const t=this.list.reduce((e,o)=>e+(o.Quantity||1),0);this.shipping=10+(t-1)*2,t===0&&(this.shipping=0),this.tax=this.itemTotal*.06,this.orderTotal=this.itemTotal+this.shipping+this.tax,this.displayOrderTotals()}displayOrderTotals(){const t=document.querySelector(this.outputSelector+" #shipping-est"),e=document.querySelector(this.outputSelector+" #tax-amount"),o=document.querySelector(this.outputSelector+" #order-total");t&&(t.innerText="$"+this.shipping.toFixed(2)),e&&(e.innerText="$"+this.tax.toFixed(2)),o&&(o.innerText="$"+this.orderTotal.toFixed(2))}async checkout(){const t=document.forms["checkout-form"];if(!t){console.error("Checkout form not found."),alert("Checkout form is missing. Please refresh the page.");return}const e=p(t);e.orderDate=new Date,e.orderTotal=this.orderTotal.toFixed(2),e.tax=this.tax.toFixed(2),e.shipping=this.shipping.toFixed(2),e.items=d(this.list);try{const o=await f(e);alert("Order Placed Successfully!"),l(this.key,[]),location.assign("/WDD330/checkout/success.html")}catch(o){console.log(o);let i=[];o.message&&(typeof o.message=="object"?i.push(o.message.message||JSON.stringify(o.message)):i.push(o.message)),alert("Order Failed: "+i.join(`
`))}}}function p(s){const t=new FormData(s),e={};return t.forEach(function(o,i){e[i]=o}),e}async function f(s){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},e=await fetch(h+"checkout",t);if(e.ok)return e.json();throw{name:"servicesError",message:await e.json()}}u();const r=new m("so-cart",".checkout-summary");r.init();const a=document.querySelector("#zip");a&&a.addEventListener("blur",r.calculateOrdertotal.bind(r));const c=document.querySelector("#checkout-form");c&&c.addEventListener("submit",s=>{s.preventDefault();const t=document.forms["checkout-form"],e=t.checkValidity();t.reportValidity(),e&&r.checkout()});
