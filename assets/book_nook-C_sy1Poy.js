import"./modulepreload-polyfill-B5Qt9EMX.js";const R="https://openlibrary.org/search.json";async function b(e){if(!e)return[];const t=encodeURIComponent(e),n=`${R}?q=${t}&fields=key,title,author_name,cover_i,publish_year,publisher,language,number_of_pages_median&limit=24`;try{const s=await fetch(n);if(!s.ok)throw new Error(`API Error: ${s.statusText}`);return(await s.json()).docs}catch(s){throw console.error("Failed to fetch books:",s),s}}class w{constructor(t){this.key=t}get(){const t=localStorage.getItem(this.key);return t?JSON.parse(t):[]}set(t){localStorage.setItem(this.key,JSON.stringify(t))}add(t){const n=this.get();return n.some(s=>s.key===t.key)?!1:(n.push(t),this.set(n),!0)}remove(t){let n=this.get();n=n.filter(s=>s.key!==t),this.set(n)}has(t){return this.get().some(s=>s.key===t)}}const T="https://via.placeholder.com/200x280?text=No+Cover";function q(e,t,n={}){if(t.innerHTML="",!e||e.length===0){const s=n.emptyMessage||"No books found.";t.innerHTML=`<div class="empty-state"><p>${s}</p></div>`;return}e.forEach(s=>{const i=document.createElement("div");i.className="book-card";const m=s.title||"Unknown Title",$=s.author_name?s.author_name.slice(0,2).join(", "):"Unknown Author",A=s.cover_i?`https://covers.openlibrary.org/b/id/${s.cover_i}-M.jpg`:T,I=s.publish_year?s.publish_year[0]:"N/A",S=s.number_of_pages_median?`${s.number_of_pages_median} pp`:"";let l="";n.view==="search"?l=`<button class="action-btn add-btn" data-key="${s.key}">âœ¨ Add to Wishlist</button>`:n.view==="wishlist"?l=`
                <button class="action-btn move-btn" data-key="${s.key}">âœ… Mark Read</button>
                <button class="action-btn delete delete-btn" data-key="${s.key}">ðŸ—‘ Remove</button>
             `:n.view==="history"&&(l=`<button class="action-btn delete delete-btn" data-key="${s.key}">ðŸ—‘ Remove</button>`);const M=`
            <img src="${A}" alt="Cover of ${m}" class="book-cover" loading="lazy">
            <h4>${m}</h4>
            <p class="author">${$}</p>
            <div class="meta">
                <span>${I}</span>
                <span>${S}</span>
            </div>
            <div class="card-actions">
                ${l}
            </div>
        `;i.innerHTML=M;const f=i.querySelector(".add-btn");f&&f.addEventListener("click",()=>n.onAdd(s));const v=i.querySelector(".move-btn");v&&v.addEventListener("click",()=>n.onMove(s));const p=i.querySelector(".delete-btn");p&&p.addEventListener("click",()=>n.onRemove(s.key)),t.appendChild(i)})}let r=[],o="search";const a=new w("book-nook-wishlist"),d=new w("book-nook-history"),_=document.getElementById("searchInput"),L=document.getElementById("searchBtn"),h=document.getElementById("bookGrid"),g=document.getElementById("loadingIndicator"),C=document.getElementById("testApiBtn"),B=document.getElementById("sortSelect"),E=document.querySelectorAll(".nav-btn");function P(){u("search")}L.addEventListener("click",()=>{const e=_.value.trim();e&&(o!=="search"&&u("search"),H(e))});_.addEventListener("keypress",e=>{e.key==="Enter"&&L.click()});C.addEventListener("click",async()=>{console.log("Test API Clicked");const e="Harry Potter";try{const t=await b(e);console.log("API Results:",t),alert(`API Test Successful! Found ${t.length} books. Check console details.`)}catch(t){console.error("API Test Failed",t),alert("API Test Failed. Check console.")}});E.forEach(e=>{e.addEventListener("click",t=>{const n=t.target.dataset.view;u(n)})});B.addEventListener("change",()=>{y(),c()});async function H(e){k(!0);try{r=await b(e),y(),c()}catch{h.innerHTML='<div class="empty-state"><p>Something went wrong. Please try again.</p></div>'}finally{k(!1)}}function u(e){o=e,E.forEach(t=>{t.dataset.view===e?t.classList.add("active"):t.classList.remove("active")}),e==="wishlist"?(r=a.get(),document.querySelector(".search-bar").style.visibility="hidden"):e==="history"?(r=d.get(),document.querySelector(".search-bar").style.visibility="hidden"):document.querySelector(".search-bar").style.visibility="visible",y(),c()}function c(){const e={view:o,onAdd:N,onRemove:F,onMove:U};o==="wishlist"&&(e.emptyMessage="Your wishlist is empty. Go search for books!"),o==="history"&&(e.emptyMessage="You haven't finished any books yet."),q(r,h,e)}function y(){const e=B.value;r.sort((t,n)=>{if(e==="title")return(t.title||"").localeCompare(n.title||"");if(e==="newest"){const s=t.publish_year?t.publish_year[0]:0;return(n.publish_year?n.publish_year[0]:0)-s}else if(e==="oldest"){const s=t.publish_year?t.publish_year[0]:0,i=n.publish_year?n.publish_year[0]:0;return s-i}return 0})}function k(e){e?(g.classList.remove("hidden"),h.classList.add("hidden")):(g.classList.add("hidden"),h.classList.remove("hidden"))}function N(e){const t=a.add(e);alert(t?`Added "${e.title}" to Wishlist!`:`"${e.title}" is already in your Wishlist.`)}function F(e){o==="wishlist"?(a.remove(e),r=a.get()):o==="history"&&(d.remove(e),r=d.get()),c()}function U(e){d.add(e),a.remove(e.key),r=a.get(),c(),alert(`Marked "${e.title}" as Read!`)}P();
